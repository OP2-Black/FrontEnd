<!DOCTYPE html>
<html lang="fi">
  <head>
    <meta charset="UTF-8" />
    <title>Airport Fuel Status</title>
    <style>
      table,
      th,
      td {
        border: 1px solid black;
        border-collapse: collapse;
      }
      th,
      td {
        padding: 5px;
        text-align: left;
      }
    </style>
  </head>
  <body>
    <h1>Airport Fuel Status</h1>
    <label for="airportCodeInput">Airport Code:</label>
    <input
      type="text"
      id="airportCodeInput"
      placeholder="Enter Airport Code or URL"
    />
    <button id="searchButton">Search</button>
    <table id="data-table">
      <thead>
        <tr>
          <th>Airport Code</th>
          <th>PO User Status</th>
          <th>Avgas 100LL</th>
          <th>Jet A-1</th>
          <th>Mogas</th>
        </tr>
      </thead>
      <tbody id="table-body">
        <!-- Data rows will be added here -->
      </tbody>
    </table>

    <script>
      function extractAirportCodeFromURL(url) {
        let basePath = url.split("?")[0];
        basePath = basePath.replace(/\/$/, "");
        const lastHyphenIndex = basePath.lastIndexOf("-");
        if (lastHyphenIndex === -1 || lastHyphenIndex === basePath.length - 1) {
          return "";
        }
        const airportCode = basePath
          .substring(lastHyphenIndex + 1)
          .toUpperCase();
        return airportCode;
      }

      function createTableRow(data) {
        const row = document.createElement("tr");

        let cell = document.createElement("td");
        cell.textContent = data.airportCode;
        row.appendChild(cell);

        cell = document.createElement("td");
        cell.textContent = data.pouserStatus;
        row.appendChild(cell);

        // Match the keys from your JSON structure's fuelPrices object
        cell = document.createElement("td");
        cell.textContent = data.fuelPrices["AVGAS 100LL"];
        row.appendChild(cell);

        cell = document.createElement("td");
        cell.textContent = data.fuelPrices["JET A-1"];
        row.appendChild(cell);

        cell = document.createElement("td");
        cell.textContent = data.fuelPrices["MOGAS"];
        row.appendChild(cell);

        return row;
      }

      function displayData(data) {
        const tableBody = document.getElementById("table-body");
        tableBody.innerHTML = "";
        data.forEach((dataItem) => {
          tableBody.appendChild(createTableRow(dataItem));
        });
      }

      function filterData(airportList, airportCode) {
        return airportList.filter(
          (item) => item.airportCode.toUpperCase() === airportCode.toUpperCase()
        );
      }

      function fetchData(airportCode = "") {
        fetch("https://jtjuslin.kapsi.fi/kananen/fuelprices.php")
          .then((response) => response.json())
          .then((jsonData) => {
            let data = jsonData.airportList; // Access the airportList from JSON
            let filteredData = airportCode
              ? filterData(data, airportCode)
              : data;
            displayData(filteredData);
          })
          .catch((error) => console.error("Error fetching data:", error));
      }

      document.getElementById("searchButton").addEventListener("click", () => {
        const input = document.getElementById("airportCodeInput").value;
        // Determine if input is a URL or an airport code
        const airportCode = input.includes("/")
          ? extractAirportCodeFromURL(input)
          : input.toUpperCase();
        fetchData(airportCode);
      });

      // Initially load all data
      fetchData();
    </script>
  </body>
</html>
